name: Create OneNote Notebook

on:
  schedule:
    # å‘¨ä¸€ã€ä¸‰ã€äº” åŒ—äº¬æ—¶é—´ 10:37 (UTC 02:37)
    - cron: '37 2 * * 1,3,5'
    # å‘¨äºŒã€å›› åŒ—äº¬æ—¶é—´ 11:21 (UTC 03:21)
    - cron: '21 3 * * 2,4'
  workflow_dispatch:

jobs:
  create_notebook:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # ğŸ”´ ä¿®æ”¹ç‚¹ 1ï¼šå¦‚æœæ˜¯æœ¬åœ° act è¿è¡Œï¼Œæ‰‹åŠ¨å®‰è£…ç³»ç»Ÿçº§ Python ä¾èµ–
      - name: Install System Dependencies (Local ARM64)
        if: ${{ env.ACT }}
        run: |
          apt-get update
          apt-get install -y python3-pip python3-venv

      # ğŸ”´ ä¿®æ”¹ç‚¹ 2ï¼šå¦‚æœæ˜¯æœ¬åœ° act è¿è¡Œï¼Œè·³è¿‡ setup-pythonï¼ˆå› ä¸º ARM64 å…¼å®¹æ€§å·®ï¼‰
      - name: Set up Python
        if: ${{ !env.ACT }}
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'

      # ğŸŸ¢ ä¿®æ”¹ç‚¹ 3ï¼šå®‰è£… Python åº“ (ä¸ºäº†å…¼å®¹ Debian ç³»ç»Ÿï¼Œå¢åŠ  --break-system-packages)
      - name: Install dependencies
        run: |
          # å…¼å®¹å¤„ç†ï¼šå¦‚æœåœ¨ act å®¹å™¨é‡Œï¼Œå¯èƒ½éœ€è¦åŠ å‚æ•°å…è®¸ç³»ç»Ÿçº§å®‰è£…
          if [ "$ACT" = "true" ]; then
            pip install -r requirements.txt --break-system-packages
          else
            pip install -r requirements.txt
          fi

      - name: Run Python script
        run: python create_notebook.py
        env:
          CLIENT_ID: ${{ secrets.CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
          TENANT_ID: ${{ secrets.TENANT_ID }}
          GRAPH_REFRESH_TOKEN: ${{ secrets.GRAPH_REFRESH_TOKEN }}
          LATITUDE: ${{ secrets.LATITUDE }}
          LONGITUDE: ${{ secrets.LONGITUDE }}