name: Unsplash to OneDrive

on:
  schedule:
    # åŒ—äº¬æ—¶é—´æ¯å¤©æ—©æ™¨ 10:06 è¿è¡Œï¼ˆUTC 02:06ï¼‰
    - cron: '6 2 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  download_and_upload:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # ğŸ”´ æ–°å¢ï¼šå¦‚æœæ˜¯æœ¬åœ° act è¿è¡Œï¼Œæ‰‹åŠ¨å®‰è£…ç³»ç»Ÿçº§ Python ä¾èµ–
      - name: Install System Dependencies (Local ARM64)
        if: ${{ env.ACT }}
        run: |
          apt-get update
          apt-get install -y python3-pip python3-venv

      # ğŸ”´ ä¿®æ”¹ï¼šå¦‚æœæ˜¯æœ¬åœ° act è¿è¡Œï¼Œè·³è¿‡ setup-pythonï¼ˆé¿å… ARM64 å…¼å®¹æ€§é—®é¢˜ï¼‰
      - name: Set up Python
        if: ${{ !env.ACT }}
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'

      # ğŸŸ¢ ä¿®æ”¹ï¼šå®‰è£…ä¾èµ–æ—¶çš„å…¼å®¹æ€§å¤„ç†
      - name: Install dependencies
        run: |
          # å…¼å®¹å¤„ç†ï¼šå¦‚æœåœ¨ act å®¹å™¨é‡Œ (Debian)ï¼Œéœ€è¦åŠ å‚æ•°å…è®¸ç³»ç»Ÿçº§å®‰è£…
          if [ "$ACT" = "true" ]; then
            pip install -r requirements.txt --break-system-packages
          else
            pip install -r requirements.txt
          fi

      - name: Run Unsplash to OneDrive script
        run: |
          python unsplash_to_onedrive.py
        env:
          CLIENT_ID: ${{ secrets.CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
          TENANT_ID: ${{ secrets.TENANT_ID }}
          GRAPH_REFRESH_TOKEN: ${{ secrets.GRAPH_REFRESH_TOKEN }}
          UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}