åœ¨ Azure Portal
 æ³¨å†Œåº”ç”¨ï¼š

è®°å½• Application (client) ID å’Œ Directory (tenant) IDã€‚

åœ¨ã€Œè¯ä¹¦å’Œå¯†ç ã€é‡Œåˆ›å»ºä¸€ä¸ª client_secretï¼Œè®°ä¸‹æ¥ã€‚

åœ¨ã€Œèº«ä»½éªŒè¯ (Authentication)ã€é‡Œæ·»åŠ ä¸€ä¸ª é‡å®šå‘ URIï¼Œæ¯”å¦‚ï¼š

http://localhost


ç¡®ä¿å¯ç”¨äº† å…è®¸å…¬å…±å®¢æˆ·ç«¯æµ (allow public client flows)ï¼ˆå¦‚æœéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰ã€‚

ç¡®è®¤ API æƒé™ï¼Œæ¯”å¦‚ï¼š

User.Read

åŠ ä¸Š offline_accessï¼ˆå¿…é¡»è¦æœ‰ï¼Œå¦åˆ™ä¸ä¼šè¿”å› refresh_tokenï¼‰ã€‚

ğŸ”¹ è·å–æˆæƒç ï¼ˆæµè§ˆå™¨æ­¥éª¤ï¼‰

åœ¨æµè§ˆå™¨é‡Œè®¿é—®ä¸‹é¢çš„ URLï¼ˆæ›¿æ¢æ‰ {tenant_id} å’Œ {client_id}ï¼‰ï¼š

https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/authorize?
client_id={client_id}
&response_type=code
&redirect_uri=http://localhost
&response_mode=query
&scope=offline_access%20User.Read
&state=12345

å‚æ•°è§£é‡Šï¼š

client_id â†’ ä½ çš„åº”ç”¨æ³¨å†Œé‡Œçš„ Client ID

tenant_id â†’ ä½ çš„ Azure AD ç§Ÿæˆ· ID

redirect_uri â†’ å¿…é¡»å’Œåº”ç”¨æ³¨å†Œé‡Œé…ç½®çš„ä¸€è‡´ï¼ˆä¾‹å¦‚ http://localhostï¼‰

scope â†’ åŒ…å« offline_access æ‰ä¼šè¿”å› refresh_token

response_type=code â†’ å‘Šè¯‰å¾®è½¯ä½ è¦æˆæƒç 

response_mode=query â†’ æˆæƒç ä¼šæ”¾åœ¨ URL çš„æŸ¥è¯¢å‚æ•°é‡Œè¿”å›

ğŸ”¹ ç™»å½•å¹¶åŒæ„

æ‰“å¼€ä¸Šé¢ URL â†’ ç³»ç»Ÿä¼šè·³è½¬åˆ°å¾®è½¯ç™»å½•é¡µã€‚

è¾“å…¥è´¦å·å¯†ç ï¼Œå®Œæˆå¤šå› å­éªŒè¯ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

å¦‚æœç¬¬ä¸€æ¬¡ç™»å½•ï¼Œä¼šå¼¹å‡ºä¸€ä¸ª åŒæ„æˆæƒ çš„é¡µé¢ï¼ˆæ¯”å¦‚å…è®¸è®¿é—® User.Readï¼‰ã€‚

ğŸ”¹ è·å–æˆæƒç 

ç™»å½•å®Œæˆåï¼Œæµè§ˆå™¨ä¼šè·³è½¬åˆ°ç±»ä¼¼è¿™æ ·çš„ç½‘å€ï¼š

http://localhost/?code=0.AAAA...snip...AA&state=12345&session_state=abcd-efgh


å…¶ä¸­ï¼š

code=0.AAAA... å°±æ˜¯ authorization_codeï¼ˆåªç”¨è¿™ä¸€æ®µï¼‰ã€‚

state=12345 æ˜¯ä½ ä¼ è¿›å»çš„ï¼Œç”¨æ¥é˜²æ­¢ CSRF æ”»å‡»ã€‚

session_state=... å¯ä»¥å¿½ç•¥ã€‚

å¤åˆ¶ code=... éƒ¨åˆ†ï¼Œå¤‡ç”¨ã€‚
